<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.chenlin.dp.modules.biz.member.dao.MemberloginlogMapper">

    <select id="listForPage" resultType="net.chenlin.dp.modules.biz.member.entity.MemberloginlogEntity">
        SELECT
        `id`,
        `createDate`,
        `modifyDate`,
        `ip`,
        `mid`,
        `mnickName`,
        `mtel`,
        `deviceType`,
        `deviceVersion`,
        `mheadPic`,
        `username`,
        `ipAddr`,
        `org_id`
        FROM
        member_login_log
        where
        1=1
        <if test="id != null">and `id` = #{id}</if>
        <if test="createdate != null">and `createDate` = #{createdate}</if>
        <if test="modifydate != null">and `modifyDate` = #{modifydate}</if>
        <if test="ip != null">and `ip` = #{ip}</if>
        <if test="mid != null">and `mid` = #{mid}</if>
        <if test="mnickname != null">and `mnickName` = #{mnickname}</if>
        <if test="mtel != null">and `mtel` = #{mtel}</if>
        <if test="deviceType != null">and `deviceType` = #{deviceType}</if>
        <if test="deviceVersion != null">and `deviceVersion` = #{deviceVersion}</if>
        <if test="mheadPic != null">and `mheadPic` = #{mheadPic}</if>
        <if test="username != null">and `username` = #{username}</if>
        <if test="ipAddr != null">and `ipAddr` = #{ipAddr}</if>
        <if test="org_id != null">and `org_id` = #{org_id}</if>
        <if test="ids != null">
            and `mid` IN
            <foreach item="id" collection="ids" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>

        ORDER BY id DESC
    </select>

    <insert id="save">
        INSERT INTO member_login_log (`id`,
                                    `createDate`,
                                    `modifyDate`,
                                    `ip`,
                                    `mid`,
                                    `mnickName`,
                                    `mtel`,
                                    `deviceType`,
                                    `deviceVersion`,
                                    `mheadPic`,
                                    `username`,
                                    `ipAddr`,
                                    `org_id`)
        VALUES (#{id},
                #{createdate},
                #{modifydate},
                #{ip},
                #{mid},
                #{mnickname},
                #{mtel},
                #{deviceType},
                #{deviceVersion},
                #{mheadPic},
                #{username},
                #{ipAddr},
                #{org_id})
    </insert>

    <select id="getObjectById" resultType="net.chenlin.dp.modules.biz.member.entity.MemberloginlogEntity">
        SELECT `id`,
               `createDate`,
               `modifyDate`,
               `ip`,
               `mid`,
               `mnickName`,
               `mtel`,
               `deviceType`,
               `deviceVersion`,
               `mheadPic`,
               `username`,
               `ipAddr`,
               `org_id`
        FROM member_login_log
        WHERE id = #{id}
    </select>

    <update id="update">
        UPDATE member_login_log
        <set>
            <if test="createdate != null">`createDate` = #{createdate},</if>
            <if test="modifydate != null">`modifyDate` = #{modifydate},</if>
            <if test="ip != null">`ip` = #{ip},</if>
            <if test="mid != null">`mid` = #{mid},</if>
            <if test="mnickname != null">`mnickName` = #{mnickname},</if>
            <if test="mtel != null">`mtel` = #{mtel},</if>
            <if test="deviceType != null">`deviceType` = #{deviceType},</if>
            <if test="deviceVersion != null">`deviceVersion` = #{deviceVersion},</if>
            <if test="mheadPic != null">`mheadPic` = #{mheadPic},</if>
            <if test="username != null">`username` = #{username},</if>
            <if test="ipAddr != null">`ipAddr` = #{ipAddr},</if>
        </set>
        WHERE
        id = #{id} and org_id = #{org_id}
    </update>

    <delete id="batchRemove">
        DELETE
        FROM
        member_login_log
        WHERE
        id IN
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <select id="getObjectGroupByDate" resultType="net.chenlin.dp.modules.biz.bussiness.entity.YyMOnlineDayEntity">
        SELECT date_format(createdate, '%Y-%m-%d') as create_time,
               count(distinct mid)                 as m_online_number
        FROM member_login_log
        where createdate &gt;= str_to_date(#{startdate}, '%Y-%m-%d')
            and createdate &lt; date_add(str_to_date(#{enddate}, '%Y-%m-%d'), INTERVAL 1 day)
            and org_id = #{org_id}
        group by date_format(createdate, '%Y-%m-%d')
    </select>

    <select id="getLastLoginDate" resultType="net.chenlin.dp.modules.biz.member.entity.MemberloginlogEntity">
        SELECT `id`,
        `createDate`,
        `modifyDate`,
        `ip`,
        `mid`,
        `mnickName`,
        `mtel`,
        `deviceType`,
        `deviceVersion`,
        `mheadPic`,
        `username`,
        `ipAddr`,
        `org_id`
        FROM member_login_log
        WHERE mid = #{memberId}
        <if test="mnickname != null">and `mnickName` = #{mnickname}</if>
        <if test="username != null">and `username` = #{username}</if>
        <if test="ip != null">and `ip` = #{ip}</if>
        <if test="org_id != null">and `org_id` = #{org_id}</if>
        <if test="startdate != null and enddate != null">
            createdate &gt;= str_to_date(#{startdate}, '%Y-%m-%d') and createdate &lt; date_add(str_to_date(#{enddate},
            '%Y-%m-%d'), INTERVAL 1 day)
        </if>
        order by createDate desc limit 1
    </select>

</mapper>